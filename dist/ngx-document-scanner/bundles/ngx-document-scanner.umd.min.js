!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("@angular/core"),require("@angular/flex-layout"),require("@angular/material"),require("angular2-draggable"),require("@angular/common"),require("ngx-opencv")):"function"==typeof define&&define.amd?define("ngx-document-scanner",["exports","rxjs","@angular/core","@angular/flex-layout","@angular/material","angular2-draggable","@angular/common","ngx-opencv"],e):e(t["ngx-document-scanner"]={},t.rxjs,t.ng.core,t.ng["flex-layout"],t.ng.material,t.angular2Draggable,t.ng.common,t.ngxOpencv)}(this,function(t,e,o,i,n,r,s,a){"use strict";function h(e,s,a,c){return new(a||(a=Promise))(function(t,i){function n(t){try{r(c.next(t))}catch(e){i(e)}}function o(t){try{r(c["throw"](t))}catch(e){i(e)}}function r(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,o)}r((c=c.apply(e,s||[])).next())})}function p(n,o){var r,s,a,t,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function i(t){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(a=2&t[0]?s["return"]:t[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,s=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=o.call(n,c)}catch(e){t=[6,e],s=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}function c(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=r.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}var l=function(){function t(){this.limitDirections=["left","right","top","bottom"],this._limits={top:0,bottom:0,right:0,left:0},this._points=[],this.positions=new e.BehaviorSubject(Array.from(this._points)),this.repositionEvent=new e.BehaviorSubject([]),this.limits=new e.BehaviorSubject(this._limits),this.paneDimensions=new e.BehaviorSubject({width:0,height:0})}return t.prototype.setPaneDimensions=function(i){var n=this;return new Promise(function(t,e){n._paneDimensions=i,n.paneDimensions.next(i),t()})},t.prototype.repositionPoints=function(t){var e=this;(this._points=t).forEach(function(t){e.positionChange(t)}),this.repositionEvent.next(t)},t.prototype.positionChange=function(t){var n=this;this.updatePosition(t),this.limitDirections.forEach(function(e){var t,i=n._points.filter(function(t){return t.roles.includes(e)}).map(function(t){return t[n.getDirectionAxis(e)]});"top"!==e&&"left"!==e||(t=Math.max.apply(Math,g(i))),"right"!==e&&"bottom"!==e||(t=Math.min.apply(Math,g(i))),n._limits[e]=t}),this.limits.next(this._limits),this.positions.next(Array.from(this._points))},t.prototype.updatePosition=function(e){var i=this,t=this._points.findIndex(function(t){return i.compareArray(e.roles,t.roles)});-1===t?this._points.push(e):this._points.splice(t,1,e)},t.prototype.exceedsLimit=function(i){var n=this,t=this.limitDirections.filter(function(t){return!i.roles.includes(t)}),o={exceeds:!1,resetCoefficients:{x:0,y:0},resetCoordinates:{x:i.x,y:i.y}};return t.forEach(function(t){var e=n.getDirectionAxis(t);"top"===t||"left"===t?i[e]<n._limits[t]&&(o.resetCoefficients[e]=1,o.resetCoordinates[e]=n._limits[t]):"right"!==t&&"bottom"!==t||i[e]>n._limits[t]&&(o.resetCoefficients[e]=-1,o.resetCoordinates[e]=n._limits[t])}),0===o.resetCoefficients.x&&0===o.resetCoefficients.y||(o.exceeds=!0),o},t.prototype.rotateClockwise=function(t,e,i){var n=this;i=i.map(function(t){return new u({x:t.x/e.width,y:t.y/e.height},t.roles)}),this.repositionPoints(i.map(function(t){return n.rotateCornerClockwise(t)}))},t.prototype.rotateCornerClockwise=function(e){var i=this,t={x:this._paneDimensions.width*(1-e.y),y:this._paneDimensions.height*e.x,roles:[]},n=[["bottom","left"],["top","left"],["top","right"],["bottom","right"],["bottom","left"]];return t.roles=n[n.findIndex(function(t){return i.compareArray(t,e.roles)})+1],t},t.prototype.compareArray=function(t,e){return t.every(function(t){return e.includes(t)})&&t.length===e.length},t.prototype.getDirectionAxis=function(t){return{left:"x",right:"x",top:"y",bottom:"y"}[t]},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=o.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),u=function b(t,e){this.x=t.x,this.y=t.y,this.roles=e},m=function(){function t(t){this.limitsService=t,this.width=10,this.height=10,this.color="#3cabe2",this.shape="rect",this.pointOptions="rect",this.position={x:0,y:0}}return t.prototype.ngAfterViewInit=function(){var e=this;Object.keys(this.pointOptions).forEach(function(t){e[t]=e.pointOptions[t]}),this.limitsService.paneDimensions.subscribe(function(t){0<t.width&&0<t.width&&(e._paneDimensions={width:t.width,height:t.height},e.position=e.getInitialPosition(t),e.limitsService.positionChange(new u(e.position,e.limitRoles)))}),this.limitsService.repositionEvent.subscribe(function(t){0<t.length&&e.externalReposition(t)})},t.prototype.pointStyle=function(){return{width:this.width+"px",height:this.height+"px","background-color":this.color,"border-radius":"circle"===this.shape?"100%":0,position:"absolute"}},t.prototype.positionChange=function(t){var e=new u(t,this.limitRoles),i=this.limitsService.exceedsLimit(e);i.exceeds?this.resetPosition=i.resetCoordinates:(this.limitsService.positionChange(e),this._currentPosition=t)},t.prototype.adjustPosition=function(e){var i={x:0,y:0};Object.keys(this.startPosition).forEach(function(t){i[t]=e.resetCoordinates[t]+e.resetCoefficients[t]}),this.position=i,this.limitsService.positionChange(new u(this.position,this.limitRoles))},t.prototype.movementEnd=function(t){var e=new u(t,this.limitRoles),i=this.limitsService.exceedsLimit(e);i.exceeds&&(this.resetPosition=i.resetCoordinates,i.exceeds&&(this.adjustPosition(i),e=new u(this.position,this.limitRoles),this.limitsService.updatePosition(e)))},t.prototype.getInitialPosition=function(t){return{x:this.limitRoles.includes("left")?0:t.width-this.width/2,y:this.limitRoles.includes("top")?0:t.height-this.height/2}},t.prototype.externalReposition=function(t){var e=this;t.forEach(function(t){e.limitsService.compareArray(e.limitRoles,t.roles)&&(t=e.enforcePaneLimits(t),e.position={x:t.x,y:t.y})})},t.prototype.enforcePaneLimits=function(t){return 0===this._paneDimensions.width||0===this._paneDimensions.height||(t.x>this._paneDimensions.width&&(t.x=this._paneDimensions.width),t.x<0&&(t.x=1),t.y>this._paneDimensions.height&&(t.y=this._paneDimensions.height),t.y<0&&(t.y=1)),t},t.decorators=[{type:o.Component,args:[{selector:"ngx-draggable-point",template:'<div #point ngDraggable="draggable"\r\n     (movingOffset)="positionChange($event)"\r\n     [ngStyle]="pointStyle()"\r\n     [position]="position"\r\n     [bounds]="container"\r\n     [inBounds]="true"\r\n     (endOffset)="movementEnd($event)"\r\n      style="z-index: 1000">\r\n</div>\r\n'}]}],t.ctorParameters=function(){return[{type:l}]},t.propDecorators={width:[{type:o.Input}],height:[{type:o.Input}],color:[{type:o.Input}],shape:[{type:o.Input}],pointOptions:[{type:o.Input}],limitRoles:[{type:o.Input}],startPosition:[{type:o.Input}],container:[{type:o.Input}],_currentPosition:[{type:o.Input}]},t}(),d=function(){function t(t,e){var i=this;this.bottomSheetRef=t,this.data=e,this.filterOptions=[{name:"default",icon:"filter_b_and_w",action:function(t){i.filterSelected.emit(t)},text:"B&W"},{name:"bw2",icon:"filter_b_and_w",action:function(t){i.filterSelected.emit(t)},text:"B&W 2"},{name:"bw3",icon:"blur_on",action:function(t){i.filterSelected.emit(t)},text:"B&W 3"},{name:"magic_color",icon:"filter_vintage",action:function(t){i.filterSelected.emit(t)},text:"Magic Color"},{name:"original",icon:"crop_original",action:function(t){i.filterSelected.emit(t)},text:"Original"}],this.filterSelected=new o.EventEmitter}return t.prototype.selectOption=function(t){this.data.filter=t,this.bottomSheetRef.dismiss()},t.decorators=[{type:o.Component,args:[{selector:"ngx-filter-menu",template:'<mat-action-list>\r\n  <button mat-list-item *ngFor="let option of filterOptions" (click)="selectOption(option.name)">\r\n    <mat-icon>{{option.icon}}</mat-icon>\r\n    <span fxFlex="100" style="text-align: start; margin: 5px">{{option.text}}</span>\r\n    <span fxFlex="100"></span>\r\n    <mat-icon *ngIf="option.name === data.filter">done</mat-icon>\r\n  </button>\r\n</mat-action-list>\r\n'}]}],t.ctorParameters=function(){return[{type:n.MatBottomSheetRef},{type:undefined,decorators:[{type:o.Inject,args:[n.MAT_BOTTOM_SHEET_DATA]}]}]},t.propDecorators={filterSelected:[{type:o.Output}]},t}(),f=function(){function t(t){this.limitsService=t,this.color="#3cabe2"}return t.prototype.ngAfterViewInit=function(){var e=this;this.canvas.nativeElement.width=this.dimensions.width,this.canvas.nativeElement.height=this.dimensions.height,this.limitsService.positions.subscribe(function(t){4===t.length&&(e._points=t,e.sortPoints(),e.clearCanvas(),e.drawShape())}),this.limitsService.paneDimensions.subscribe(function(t){e.clearCanvas(),e.canvas.nativeElement.width=t.width,e.canvas.nativeElement.height=t.height}),this.limitsService.repositionEvent.subscribe(function(t){4===t.length&&setTimeout(function(){e.clearCanvas(),e.sortPoints(),e.drawShape()},10)})},t.prototype.clearCanvas=function(){this.canvas.nativeElement.getContext("2d").clearRect(0,0,this.dimensions.width,this.dimensions.height)},t.prototype.sortPoints=function(){for(var i=this,n=Array.from(this._points),o=[],r={vertical:["top","top","bottom","bottom"],horizontal:["left","right","right","left"]},t=function(t){var e=Array.from([r.vertical[t],r.horizontal[t]]);o.push(n.filter(function(t){return i.limitsService.compareArray(t.roles,e)})[0])},e=0;e<4;e++)t(e);this._sortedPoints=o},t.prototype.drawShape=function(){var n=this,o=this.canvas.nativeElement.getContext("2d");o.lineWidth=this.weight,o.strokeStyle=this.color,o.beginPath(),this._sortedPoints.forEach(function(t,e){if(0===e&&o.moveTo(t.x,t.y),e!==n._sortedPoints.length-1){var i=n._sortedPoints[e+1];o.lineTo(i.x,i.y)}else o.closePath()}),o.stroke()},t.decorators=[{type:o.Component,args:[{selector:"ngx-shape-outine",template:'<canvas #outline\r\n        style="position: absolute; z-index: 1000"\r\n        [ngStyle]="{width: dimensions.width + \'px\', height: dimensions.height + \'px\'}"\r\n        *ngIf="dimensions">\r\n</canvas>\r\n'}]}],t.ctorParameters=function(){return[{type:l}]},t.propDecorators={color:[{type:o.Input}],weight:[{type:o.Input}],dimensions:[{type:o.Input}],canvas:[{type:o.ViewChild,args:["outline"]}]},t}(),v=function(){function t(t,e,i){var n=this;this.ngxOpenCv=t,this.limitsService=e,this.bottomSheet=i,this.editorButtons=[{name:"exit",action:function(){n.exitEditor.emit("canceled")},icon:"arrow_back",type:"fab",mode:"crop"},{name:"rotate",action:this.rotateImage.bind(this),icon:"rotate_right",type:"fab",mode:"crop"},{name:"done_crop",action:function(){return h(n,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:return this.mode="color",[4,this.transform()];case 1:return t.sent(),[4,this.applyFilter(!0)];case 2:return t.sent(),[2]}})})},icon:"done",type:"fab",mode:"crop"},{name:"back",action:function(){n.mode="crop",n.loadFile(n.originalImage)},icon:"arrow_back",type:"fab",mode:"color"},{name:"filter",action:function(){return n.chooseFilters()},icon:"photo_filter",type:"fab",mode:"color"},{name:"upload",action:this.exportImage.bind(this),icon:"cloud_upload",type:"fab",mode:"color"}],this.imageLoaded=!1,this.mode="crop",this.selectedFilter="default",this.imageDimensions={width:0,height:0},this.exitEditor=new o.EventEmitter,this.editResult=new o.EventEmitter,this.error=new o.EventEmitter,this.ready=new o.EventEmitter,this.processing=new o.EventEmitter,this.screenDimensions={width:window.innerWidth,height:window.innerHeight},this.ngxOpenCv.cvState.subscribe(function(t){n.cvState=t.state,n.ready.emit(t.ready),t.error?n.error.emit(new Error("error loading cv")):t.loading?n.processing.emit(!0):t.ready&&n.processing.emit(!1)}),this.limitsService.positions.subscribe(function(t){n.points=t})}return Object.defineProperty(t.prototype,"displayedButtons",{get:function(){var e=this;return this.editorButtons.filter(function(t){return t.mode===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"file",{set:function(i){var t=this;i&&(setTimeout(function(){t.processing.emit(!0)},5),this.imageLoaded=!1,this.originalImage=i,this.ngxOpenCv.cvState.subscribe(function(e){return h(t,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:return e.ready?[4,this.loadFile(i)]:[3,2];case 1:t.sent(),this.processing.emit(!1),t.label=2;case 2:return[2]}})})}))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.options=new y(this.config),this.editorButtons.forEach(function(t){"upload"===t.name&&(t.icon=e.options.exportImageIcon)}),this.maxPreviewWidth=this.options.maxPreviewWidth,this.editorStyle=this.options.editorStyle},t.prototype.exit=function(){this.exitEditor.emit("canceled")},t.prototype.exportImage=function(){return h(this,void 0,void 0,function(){var e=this;return p(this,function(t){switch(t.label){case 0:return[4,this.applyFilter(!1)];case 1:return t.sent(),this.options.maxImageDimensions?this.resize(this.editedImage).then(function(t){t.toBlob(function(t){e.editResult.emit(t),e.processing.emit(!1)},e.originalImage.type)}):this.editedImage.toBlob(function(t){e.editResult.emit(t),e.processing.emit(!1)},this.originalImage.type),[2]}})})},t.prototype.chooseFilters=function(){var t=this,e={filter:this.selectedFilter};this.bottomSheet.open(d,{data:e}).afterDismissed().subscribe(function(){t.selectedFilter=e.filter,t.applyFilter(!0)})},t.prototype.loadFile=function(r){var e=this;return new Promise(function(o,t){return h(e,void 0,void 0,function(){var e,i,n=this;return p(this,function(t){switch(t.label){case 0:this.processing.emit(!0),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.readImage(r)];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),console.error(e),this.error.emit(new Error(e)),[3,4];case 4:return t.trys.push([4,6,,7]),[4,this.showPreview()];case 5:return t.sent(),[3,7];case 6:return i=t.sent(),console.error(i),this.error.emit(new Error(i)),[3,7];case 7:return this.imageLoaded=!0,[4,this.limitsService.setPaneDimensions({width:this.previewDimensions.width,height:this.previewDimensions.height})];case 8:return t.sent(),setTimeout(function(){return h(n,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:return[4,this.detectContours()];case 1:return t.sent(),this.processing.emit(!1),o(),[2]}})})},15),[2]}})})})},t.prototype.readImage=function(c){var t=this;return new Promise(function(s,a){return h(t,void 0,void 0,function(){var i,n,o,r=this;return p(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function e(){return new Promise(function(e,i){var n=new FileReader;n.onload=function(t){e(n.result)},n.onerror=function(t){i(t)},n.readAsDataURL(c)})}()];case 1:return i=t.sent(),[3,3];case 2:return n=t.sent(),a(n),[3,3];case 3:return(o=new Image).onload=function(){return h(r,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return this.editedImage=document.createElement("canvas"),this.editedImage.width=o.width,this.editedImage.height=o.height,this.editedImage.getContext("2d").drawImage(o,0,0),(o.width>o.height?o.height:o.width)>this.options.maxImageDimensions.width?[4,(e=this).resize(this.editedImage)]:[3,2];case 1:e.editedImage=t.sent(),t.label=2;case 2:return this.imageDimensions.width=this.editedImage.width,this.imageDimensions.height=this.editedImage.height,this.setPreviewPaneDimensions(this.editedImage),s(),[2]}})})},o.src=i,[2]}})})})},t.prototype.rotateImage=function(){var r=this;return new Promise(function(o,t){r.processing.emit(!0),setTimeout(function(){var t=cv.imread(r.editedImage);cv.transpose(t,t),cv.flip(t,t,1),cv.imshow(r.editedImage,t),t["delete"]();var e={width:0,height:0};Object.assign(e,r.previewDimensions);var i=Array.from(r.points);r.setPreviewPaneDimensions(r.editedImage);var n={width:r.previewDimensions.width/e.width,height:r.previewDimensions.height/e.height};r.limitsService.rotateClockwise(n,e,i),r.showPreview().then(function(){r.processing.emit(!1),o()})},30)})},t.prototype.detectContours=function(){var a=this;return new Promise(function(s,t){a.processing.emit(!0),setTimeout(function(){var t=cv.imread(a.editedImage),e=(new cv.Size(.5*t.rows,.5*t.cols),new cv.Size(5,5));cv.cvtColor(t,t,cv.COLOR_RGBA2GRAY,0),cv.GaussianBlur(t,t,e,0,0,cv.BORDER_DEFAULT),cv.Canny(t,t,75,200),cv.threshold(t,t,120,200,cv.THRESH_BINARY);var i=new cv.MatVector,n=new cv.Mat;cv.findContours(t,i,n,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);var o=cv.boundingRect(t);t["delete"](),n["delete"](),i["delete"](),Object.keys(o).forEach(function(t){o[t]=o[t]*a.imageResizeRatio});var r=[new u({x:o.x,y:o.y},["left","top"]),new u({x:o.x+o.width,y:o.y},["right","top"]),new u({x:o.x+o.width,y:o.y+o.height},["right","bottom"]),new u({x:o.x,y:o.y+o.height},["left","bottom"])];a.limitsService.repositionPoints(r),s()},30)})},t.prototype.transform=function(){var d=this;return new Promise(function(m,t){d.processing.emit(!0),setTimeout(function(){var t=cv.imread(d.editedImage),e=[d.getPoint(["top","left"]),d.getPoint(["top","right"]),d.getPoint(["bottom","right"]),d.getPoint(["bottom","left"])].map(function(t){return[t.x/d.imageResizeRatio,t.y/d.imageResizeRatio]}),i=d.getPoint(["bottom","right"]).x-d.getPoint(["bottom","left"]).x,n=d.getPoint(["top","right"]).x-d.getPoint(["top","left"]).x,o=Math.max(i,n)/d.imageResizeRatio,r=d.getPoint(["bottom","left"]).y-d.getPoint(["top","left"]).y,s=d.getPoint(["bottom","right"]).y-d.getPoint(["top","right"]).y,a=Math.max(r,s)/d.imageResizeRatio,c=[[0,0],[o-1,0],[o-1,a-1],[0,a-1]],h=cv.matFromArray(4,1,cv.CV_32FC2,[].concat.apply([],g(e))),p=cv.matFromArray(4,1,cv.CV_32FC2,[].concat.apply([],g(c))),l=cv.getPerspectiveTransform(h,p),u=new cv.Size(o,a);cv.warpPerspective(t,t,l,u,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),cv.imshow(d.editedImage,t),t["delete"](),h["delete"](),p["delete"](),l["delete"](),d.setPreviewPaneDimensions(d.editedImage),d.showPreview().then(function(){d.processing.emit(!1),m()})},30)})},t.prototype.applyFilter=function(r){var e=this;return new Promise(function(o,t){return h(e,void 0,void 0,function(){var i,n,e=this;return p(this,function(t){switch(this.processing.emit(!0),i={blur:!1,th:!0,thMode:cv.ADAPTIVE_THRESH_MEAN_C,thMeanCorrection:10,thBlockSize:25,thMax:255,grayScale:!0},n=cv.imread(this.editedImage),this.selectedFilter){case"original":i.th=!1,i.grayScale=!1,i.blur=!1;break;case"magic_color":i.grayScale=!1;break;case"bw2":i.thMode=cv.ADAPTIVE_THRESH_GAUSSIAN_C,i.thMeanCorrection=15,i.thBlockSize=15;break;case"bw3":i.blur=!0,i.thMeanCorrection=15}return setTimeout(function(){return h(e,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return i.grayScale&&cv.cvtColor(n,n,cv.COLOR_RGBA2GRAY,0),i.blur&&(e=new cv.Size(5,5),cv.GaussianBlur(n,n,e,0,0,cv.BORDER_DEFAULT)),i.th&&(i.grayScale?cv.adaptiveThreshold(n,n,i.thMax,i.thMode,cv.THRESH_BINARY,i.thBlockSize,i.thMeanCorrection):(n.convertTo(n,-1,1,60),cv.threshold(n,n,170,255,cv.THRESH_BINARY))),r||cv.imshow(this.editedImage,n),[4,this.showPreview(n)];case 1:return t.sent(),this.processing.emit(!1),o(),[2]}})})},30),[2]})})})},t.prototype.resize=function(a){var c=this;return new Promise(function(s,t){c.processing.emit(!0),setTimeout(function(){var t=cv.imread(a),e=t.size().width,i=t.size().height,n={width:0,height:0};if(e>c.options.maxImageDimensions.width){n.width=c.options.maxImageDimensions.width,n.height=c.options.maxImageDimensions.width/e*i,n.height>c.options.maxImageDimensions.height&&(n.height=c.options.maxImageDimensions.height,n.width=c.options.maxImageDimensions.height/i*e);var o=new cv.Size(Math.floor(n.width),Math.floor(n.height));cv.resize(t,t,o,0,0,cv.INTER_AREA);var r=document.createElement("canvas");cv.imshow(r,t),t["delete"](),c.processing.emit(!1),s(r)}else c.processing.emit(!1),s(a)},30)})},t.prototype.showPreview=function(r){var s=this;return new Promise(function(t,e){var i;i=r||cv.imread(s.editedImage);var n=new cv.Mat,o=new cv.Size(0,0);cv.resize(i,n,o,s.imageResizeRatio,s.imageResizeRatio,cv.INTER_AREA),cv.imshow(s.previewCanvas.nativeElement,n),i["delete"](),n["delete"](),t()})},t.prototype.setPreviewPaneDimensions=function(t){this.previewDimensions=this.calculateDimensions(t.width,t.height),this.previewCanvas.nativeElement.width=this.previewDimensions.width,this.previewCanvas.nativeElement.height=this.previewDimensions.height,this.imageResizeRatio=this.previewDimensions.width/t.width,this.imageDivStyle={width:this.previewDimensions.width+this.options.cropToolDimensions.width+"px",height:this.previewDimensions.height+this.options.cropToolDimensions.height+"px","margin-left":"calc((100% - "+(this.previewDimensions.width+10)+"px) / 2 + "+this.options.cropToolDimensions.width/2+"px)","margin-right":"calc((100% - "+(this.previewDimensions.width+10)+"px) / 2 - "+this.options.cropToolDimensions.width/2+"px)"},this.limitsService.setPaneDimensions({width:this.previewDimensions.width,height:this.previewDimensions.height})},t.prototype.calculateDimensions=function(t,e){var i=t/e,n=this.screenDimensions.width>this.maxPreviewWidth?this.maxPreviewWidth:this.screenDimensions.width-40,o=this.screenDimensions.height-240,r={width:n,height:Math.round(n/i),ratio:i};return r.height>o&&(r.height=o,r.width=Math.round(o*i)),r},t.prototype.getPoint=function(e){var i=this;return this.points.find(function(t){return i.limitsService.compareArray(t.roles,e)})},t.decorators=[{type:o.Component,args:[{selector:"ngx-doc-scanner",template:'<div [ngStyle]="editorStyle" fxLayoutAlign="space-around" style="direction: ltr !important">\r\n  <div #imageContainer [ngStyle]="imageDivStyle" style="margin: auto;" >\r\n    <ng-container *ngIf="imageLoaded && mode === \'crop\'">\r\n      <ngx-shape-outine #shapeOutline [color]="options.cropToolColor" [weight]="options.cropToolLineWeight" [dimensions]="previewDimensions"></ngx-shape-outine>\r\n      <ngx-draggable-point #topLeft [pointOptions]="options.pointOptions" [startPosition]="{x: 0, y: 0}" [limitRoles]="[\'top\', \'left\']" [container]="imageContainer"></ngx-draggable-point>\r\n      <ngx-draggable-point #topRight [pointOptions]="options.pointOptions" [startPosition]="{x: previewDimensions.width, y: 0}" [limitRoles]="[\'top\', \'right\']" [container]="imageContainer"></ngx-draggable-point>\r\n      <ngx-draggable-point #bottomLeft [pointOptions]="options.pointOptions" [startPosition]="{x: 0, y: previewDimensions.height}" [limitRoles]="[\'bottom\', \'left\']" [container]="imageContainer"></ngx-draggable-point>\r\n      <ngx-draggable-point #bottomRight [pointOptions]="options.pointOptions" [startPosition]="{x: previewDimensions.width, y: previewDimensions.height}" [limitRoles]="[\'bottom\', \'right\']" [container]="imageContainer"></ngx-draggable-point>\r\n    </ng-container>\r\n    <canvas #PreviewCanvas [ngStyle]="{\'max-width\': options.maxPreviewWidth}" style="z-index: 5" ></canvas>\r\n  </div>\r\n  <div class="editor-actions" fxLayout="row" fxLayoutAlign="space-around" style="position: absolute; bottom: 0; width: 100vw">\r\n    <ng-container *ngFor="let button of displayedButtons" [ngSwitch]="button.type">\r\n      <button mat-mini-fab *ngSwitchCase="\'fab\'" [name]="button.name" (click)="button.action()" [color]="options.buttonThemeColor">\r\n        <mat-icon>{{button.icon}}</mat-icon>\r\n      </button>\r\n      <button mat-raised-button *ngSwitchCase="\'button\'" [name]="button.name" (click)="button.action()" [color]="options.buttonThemeColor">\r\n        <mat-icon>{{button.icon}}</mat-icon>\r\n        <span>{{button.text}}}</span>\r\n      </button>\r\n    </ng-container>\r\n  </div>\r\n</div>\r\n\r\n\r\n',styles:[".editor-actions{padding:12px}.editor-actions button{margin:5px}"]}]}],t.ctorParameters=function(){return[{type:a.NgxOpenCVService},{type:l},{type:n.MatBottomSheet}]},t.propDecorators={previewCanvas:[{type:o.ViewChild,args:["PreviewCanvas",{read:o.ElementRef}]}],exitEditor:[{type:o.Output}],editResult:[{type:o.Output}],error:[{type:o.Output}],ready:[{type:o.Output}],processing:[{type:o.Output}],file:[{type:o.Input}],config:[{type:o.Input}]},t}(),y=function x(e){var i=this;this.maxImageDimensions={width:800,height:1200},this.editorBackgroundColor="#fefefe",this.editorDimensions={width:"100vw",height:"100vh"},this.extraCss={position:"absolute",top:0,left:0},this.buttonThemeColor="accent",this.exportImageIcon="cloud_upload",this.cropToolColor="#3cabe2",this.cropToolShape="rect",this.cropToolDimensions={width:10,height:10},this.cropToolLineWeight=3,this.maxPreviewWidth=800,e&&Object.keys(e).forEach(function(t){i[t]=e[t]}),this.editorStyle={"background-color":this.editorBackgroundColor},Object.assign(this.editorStyle,this.editorDimensions),Object.assign(this.editorStyle,this.extraCss),this.pointOptions={shape:this.cropToolShape,color:this.cropToolColor,width:0,height:0},Object.assign(this.pointOptions,this.cropToolDimensions)},w=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:a.OpenCvConfigToken,useValue:t}]}},e.decorators=[{type:o.NgModule,args:[{declarations:[m,d,f,v],imports:[i.FlexLayoutModule,n.MatButtonModule,n.MatIconModule,n.MatBottomSheetModule,n.MatListModule,r.AngularDraggableModule,s.CommonModule,a.NgxOpenCVModule],exports:[i.FlexLayoutModule,n.MatButtonModule,n.MatIconModule,n.MatBottomSheetModule,n.MatListModule,r.AngularDraggableModule,v],entryComponents:[d],providers:[a.NgxOpenCVService,l]}]}],e}();t.NgxDocumentScannerModule=w,t.NgxDocScannerComponent=v,t.ɵa=m,t.ɵc=d,t.ɵd=f,t.ɵb=l,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-document-scanner.umd.min.js.map