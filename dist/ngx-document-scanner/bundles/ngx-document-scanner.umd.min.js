!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("@angular/core"),require("@angular/flex-layout"),require("@angular/material"),require("angular2-draggable"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-document-scanner",["exports","rxjs","@angular/core","@angular/flex-layout","@angular/material","angular2-draggable","@angular/common"],e):e(t["ngx-document-scanner"]={},t.rxjs,t.ng.core,t.ng["flex-layout"],t.ng.material,t.angular2Draggable,t.ng.common)}(this,function(t,i,o,n,r,s,a){"use strict";var c=new o.InjectionToken("OpenCV config object token"),h=function(){function t(t,e){this._ngZone=e,this.cvState=new i.BehaviorSubject({ready:!1,error:!1,loading:!0,state:"loading"}),t||(t={}),this.configModule=this.generateConfigModule(t),this.loadOpenCv()}return t.prototype.loadOpenCv=function(){var e=this;this.cvState.next(this.newState("loading")),window.Module=this.configModule;var t=document.createElement("script");t.setAttribute("async",""),t.setAttribute("type","text/javascript"),t.addEventListener("error",function(){var t=new Error("Failed to load "+e.configModule.scriptUrl);e.cvState.next(e.newState("error")),e.cvState.error(t)},{passive:!0}),t.src=this.configModule.scriptUrl;var i=document.getElementsByTagName("script")[0];i?i.parentNode.insertBefore(t,i):document.head.appendChild(t)},t.prototype.newState=function(e){var i={ready:!1,loading:!1,error:!1,state:""};return Object.keys(i).forEach(function(t){"state"!==t&&(t===e?(i[t]=!0,i.state=t):i[t]=!1)}),i},t.prototype.generateConfigModule=function(t){var e=this;return{scriptUrl:t.openCvDirPath?t.openCvDirPath+"/opencv.js":"/assets/opencv/opencv.js",wasmBinaryFile:"opencv_js.wasm",usingWasm:!0,onRuntimeInitialized:function(){e._ngZone.run(function(){console.log("openCV Ready"),e.cvState.next(e.newState("ready")),t.runOnOpenCVInit&&t.runOnOpenCVInit()})}}},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[c]}]},{type:o.NgZone}]},t.ngInjectableDef=o.defineInjectable({factory:function(){return new t(o.inject(c),o.inject(o.NgZone))},token:t,providedIn:"root"}),t}();function p(e,s,a,c){return new(a||(a=Promise))(function(t,i){function n(t){try{r(c.next(t))}catch(e){i(e)}}function o(t){try{r(c["throw"](t))}catch(e){i(e)}}function r(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,o)}r((c=c.apply(e,s||[])).next())})}function l(n,o){var r,s,a,t,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function i(t){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(a=2&t[0]?s["return"]:t[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,s=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=o.call(n,c)}catch(e){t=[6,e],s=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}function u(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=r.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s}function v(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}var d=function(){function t(){this.limitDirections=["left","right","top","bottom"],this._limits={top:0,bottom:0,right:0,left:0},this._points=[],this.positions=new i.BehaviorSubject(Array.from(this._points)),this.repositionEvent=new i.BehaviorSubject([]),this.limits=new i.BehaviorSubject(this._limits),this.paneDimensions=new i.BehaviorSubject({width:0,height:0})}return t.prototype.setPaneDimensions=function(i){var n=this;return new Promise(function(t,e){n._paneDimensions=i,n.paneDimensions.next(i),t()})},t.prototype.repositionPoints=function(t){var e=this;(this._points=t).forEach(function(t){e.positionChange(t)}),this.repositionEvent.next(t)},t.prototype.positionChange=function(t){var n=this;this.updatePosition(t),this.limitDirections.forEach(function(e){var t,i=n._points.filter(function(t){return t.roles.includes(e)}).map(function(t){return t[n.getDirectionAxis(e)]});"top"!==e&&"left"!==e||(t=Math.max.apply(Math,v(i))),"right"!==e&&"bottom"!==e||(t=Math.min.apply(Math,v(i))),n._limits[e]=t}),this.limits.next(this._limits),this.positions.next(Array.from(this._points))},t.prototype.updatePosition=function(e){var i=this,t=this._points.findIndex(function(t){return i.compareArray(e.roles,t.roles)});-1===t?this._points.push(e):this._points.splice(t,1,e)},t.prototype.exceedsLimit=function(i){var n=this,t=this.limitDirections.filter(function(t){return!i.roles.includes(t)}),o={exceeds:!1,resetCoefficients:{x:0,y:0},resetCoordinates:{x:i.x,y:i.y}};return t.forEach(function(t){var e=n.getDirectionAxis(t);"top"===t||"left"===t?i[e]<n._limits[t]&&(o.resetCoefficients[e]=1,o.resetCoordinates[e]=n._limits[t]):"right"!==t&&"bottom"!==t||i[e]>n._limits[t]&&(o.resetCoefficients[e]=-1,o.resetCoordinates[e]=n._limits[t])}),0===o.resetCoefficients.x&&0===o.resetCoefficients.y||(o.exceeds=!0),o},t.prototype.rotateClockwise=function(t,e,i){var n=this;i=i.map(function(t){return new m({x:t.x/e.width,y:t.y/e.height},t.roles)}),this.repositionPoints(i.map(function(t){return n.rotateCornerClockwise(t)}))},t.prototype.rotateCornerClockwise=function(e){var i=this,t={x:this._paneDimensions.width*(1-e.y),y:this._paneDimensions.height*e.x,roles:[]},n=[["bottom","left"],["top","left"],["top","right"],["bottom","right"],["bottom","left"]];return t.roles=n[n.findIndex(function(t){return i.compareArray(t,e.roles)})+1],t},t.prototype.compareArray=function(t,e){return t.every(function(t){return e.includes(t)})&&t.length===e.length},t.prototype.getDirectionAxis=function(t){return{left:"x",right:"x",top:"y",bottom:"y"}[t]},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=o.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),m=function x(t,e){this.x=t.x,this.y=t.y,this.roles=e},g=function(){function t(t){this.limitsService=t,this.width=10,this.height=10,this.color="#3cabe2",this.shape="rect",this.pointOptions="rect",this.position={x:0,y:0}}return t.prototype.ngAfterViewInit=function(){var e=this;Object.keys(this.pointOptions).forEach(function(t){e[t]=e.pointOptions[t]}),this.limitsService.paneDimensions.subscribe(function(t){0<t.width&&0<t.width&&(e._paneDimensions={width:t.width,height:t.height},e.position=e.getInitialPosition(t),e.limitsService.positionChange(new m(e.position,e.limitRoles)))}),this.limitsService.repositionEvent.subscribe(function(t){0<t.length&&e.externalReposition(t)})},t.prototype.pointStyle=function(){return{width:this.width+"px",height:this.height+"px","background-color":this.color,"border-radius":"circle"===this.shape?"100%":0,position:"absolute"}},t.prototype.positionChange=function(t){var e=new m(t,this.limitRoles),i=this.limitsService.exceedsLimit(e);i.exceeds?this.resetPosition=i.resetCoordinates:(this.limitsService.positionChange(e),this._currentPosition=t)},t.prototype.adjustPosition=function(e){var i={x:0,y:0};Object.keys(this.startPosition).forEach(function(t){i[t]=e.resetCoordinates[t]+e.resetCoefficients[t]}),this.position=i,this.limitsService.positionChange(new m(this.position,this.limitRoles))},t.prototype.movementEnd=function(t){var e=new m(t,this.limitRoles),i=this.limitsService.exceedsLimit(e);i.exceeds&&(this.resetPosition=i.resetCoordinates,i.exceeds&&(this.adjustPosition(i),e=new m(this.position,this.limitRoles),this.limitsService.updatePosition(e)))},t.prototype.getInitialPosition=function(t){return{x:this.limitRoles.includes("left")?0:t.width-this.width/2,y:this.limitRoles.includes("top")?0:t.height-this.height/2}},t.prototype.externalReposition=function(t){var e=this;t.forEach(function(t){e.limitsService.compareArray(e.limitRoles,t.roles)&&(t=e.enforcePaneLimits(t),e.position={x:t.x,y:t.y})})},t.prototype.enforcePaneLimits=function(t){return 0===this._paneDimensions.width||0===this._paneDimensions.height||(t.x>this._paneDimensions.width&&(t.x=this._paneDimensions.width),t.x<0&&(t.x=1),t.y>this._paneDimensions.height&&(t.y=this._paneDimensions.height),t.y<0&&(t.y=1)),t},t.decorators=[{type:o.Component,args:[{selector:"ngx-draggable-point",template:'<div #point ngDraggable="draggable"\n     (movingOffset)="positionChange($event)"\n     [ngStyle]="pointStyle()"\n     [position]="position"\n     [bounds]="container"\n     [inBounds]="true"\n     (endOffset)="movementEnd($event)"\n      style="z-index: 1000">\n</div>\n'}]}],t.ctorParameters=function(){return[{type:d}]},t.propDecorators={width:[{type:o.Input}],height:[{type:o.Input}],color:[{type:o.Input}],shape:[{type:o.Input}],pointOptions:[{type:o.Input}],limitRoles:[{type:o.Input}],startPosition:[{type:o.Input}],container:[{type:o.Input}],_currentPosition:[{type:o.Input}]},t}(),f=function(){function t(t,e){var i=this;this.bottomSheetRef=t,this.data=e,this.filterOptions=[{name:"default",icon:"filter_b_and_w",action:function(t){i.filterSelected.emit(t)},text:"B&W"},{name:"bw2",icon:"filter_b_and_w",action:function(t){i.filterSelected.emit(t)},text:"B&W 2"},{name:"bw3",icon:"blur_on",action:function(t){i.filterSelected.emit(t)},text:"B&W 3"},{name:"magic_color",icon:"filter_vintage",action:function(t){i.filterSelected.emit(t)},text:"Magic Color"},{name:"original",icon:"crop_original",action:function(t){i.filterSelected.emit(t)},text:"Original"}],this.filterSelected=new o.EventEmitter}return t.prototype.selectOption=function(t){this.data.filter=t,this.bottomSheetRef.dismiss()},t.decorators=[{type:o.Component,args:[{selector:"ngx-filter-menu",template:'<mat-action-list>\r\n  <button mat-list-item *ngFor="let option of filterOptions" (click)="selectOption(option.name)">\r\n    <mat-icon>{{option.icon}}</mat-icon>\r\n    <span fxFlex="100" style="text-align: start; margin: 5px">{{option.text}}</span>\r\n    <span fxFlex="100"></span>\r\n    <mat-icon *ngIf="option.name === data.filter">done</mat-icon>\r\n  </button>\r\n</mat-action-list>\r\n'}]}],t.ctorParameters=function(){return[{type:r.MatBottomSheetRef},{type:undefined,decorators:[{type:o.Inject,args:[r.MAT_BOTTOM_SHEET_DATA]}]}]},t.propDecorators={filterSelected:[{type:o.Output}]},t}(),y=function(){function t(t){this.limitsService=t,this.color="#3cabe2"}return t.prototype.ngAfterViewInit=function(){var e=this;this.canvas.nativeElement.width=this.dimensions.width,this.canvas.nativeElement.height=this.dimensions.height,this.limitsService.positions.subscribe(function(t){4===t.length&&(e._points=t,e.sortPoints(),e.clearCanvas(),e.drawShape())}),this.limitsService.paneDimensions.subscribe(function(t){e.clearCanvas(),e.canvas.nativeElement.width=t.width,e.canvas.nativeElement.height=t.height}),this.limitsService.repositionEvent.subscribe(function(t){4===t.length&&setTimeout(function(){e.clearCanvas(),e.sortPoints(),e.drawShape()},10)})},t.prototype.clearCanvas=function(){this.canvas.nativeElement.getContext("2d").clearRect(0,0,this.dimensions.width,this.dimensions.height)},t.prototype.sortPoints=function(){for(var i=this,n=Array.from(this._points),o=[],r={vertical:["top","top","bottom","bottom"],horizontal:["left","right","right","left"]},t=function(t){var e=Array.from([r.vertical[t],r.horizontal[t]]);o.push(n.filter(function(t){return i.limitsService.compareArray(t.roles,e)})[0])},e=0;e<4;e++)t(e);this._sortedPoints=o},t.prototype.drawShape=function(){var n=this,o=this.canvas.nativeElement.getContext("2d");o.lineWidth=this.weight,o.strokeStyle=this.color,o.beginPath(),this._sortedPoints.forEach(function(t,e){if(0===e&&o.moveTo(t.x,t.y),e!==n._sortedPoints.length-1){var i=n._sortedPoints[e+1];o.lineTo(i.x,i.y)}else o.closePath()}),o.stroke()},t.decorators=[{type:o.Component,args:[{selector:"ngx-shape-outine",template:'<canvas #outline\n        style="position: fixed; z-index: 1000"\n        [ngStyle]="{width: dimensions.width + \'px\', height: dimensions.height + \'px\'}"\n        *ngIf="dimensions">\n</canvas>\n'}]}],t.ctorParameters=function(){return[{type:d}]},t.propDecorators={color:[{type:o.Input}],weight:[{type:o.Input}],dimensions:[{type:o.Input}],canvas:[{type:o.ViewChild,args:["outline"]}]},t}(),w=function(){function t(t,e,i){var n=this;this.ngxOpenCv=t,this.limitsService=e,this.bottomSheet=i,this.editorButtons=[{name:"exit",action:function(){n.exitEditor.emit("canceled")},icon:"arrow_back",type:"fab",mode:"crop"},{name:"rotate",action:this.rotateImage.bind(this),icon:"rotate_right",type:"fab",mode:"crop"},{name:"done_crop",action:function(){return p(n,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return this.mode="color",[4,this.transform()];case 1:return t.sent(),[4,this.applyFilter(!0)];case 2:return t.sent(),[2]}})})},icon:"done",type:"fab",mode:"crop"},{name:"back",action:function(){n.mode="crop",n.loadFile(n.originalImage)},icon:"arrow_back",type:"fab",mode:"color"},{name:"filter",action:function(){return n.chooseFilters()},icon:"photo_filter",type:"fab",mode:"color"},{name:"upload",action:this.exportImage.bind(this),icon:"cloud_upload",type:"fab",mode:"color"}],this.imageLoaded=!1,this.mode="crop",this.selectedFilter="default",this.imageDimensions={width:0,height:0},this.exitEditor=new o.EventEmitter,this.editResult=new o.EventEmitter,this.error=new o.EventEmitter,this.ready=new o.EventEmitter,this.processing=new o.EventEmitter,this.screenDimensions={width:window.innerWidth,height:window.innerHeight},this.ngxOpenCv.cvState.subscribe(function(t){n.cvState=t.state,n.ready.emit(t.ready),t.error?n.error.emit(new Error("error loading cv")):t.loading?n.processing.emit(!0):t.ready&&n.processing.emit(!1)}),this.limitsService.positions.subscribe(function(t){n.points=t})}return Object.defineProperty(t.prototype,"displayedButtons",{get:function(){var e=this;return this.editorButtons.filter(function(t){return t.mode===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"file",{set:function(i){var t=this;i&&(setTimeout(function(){t.processing.emit(!0)},5),this.imageLoaded=!1,this.originalImage=i,this.ngxOpenCv.cvState.subscribe(function(e){return p(t,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return e.ready?[4,this.loadFile(i)]:[3,2];case 1:t.sent(),this.processing.emit(!1),t.label=2;case 2:return[2]}})})}))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.options=new b(this.config),this.editorButtons.forEach(function(t){"upload"===t.name&&(t.icon=e.options.exportImageIcon)}),this.maxPreviewWidth=this.options.maxPreviewWidth,this.editorStyle=this.options.editorStyle},t.prototype.exit=function(){this.exitEditor.emit("canceled")},t.prototype.exportImage=function(){return p(this,void 0,void 0,function(){var e=this;return l(this,function(t){switch(t.label){case 0:return[4,this.applyFilter(!1)];case 1:return t.sent(),this.options.maxImageDimensions?this.resize().then(function(t){t.toBlob(function(t){e.editResult.emit(t),e.processing.emit(!1)},e.originalImage.type)}):this.editedImage.toBlob(function(t){e.editResult.emit(t),e.processing.emit(!1)},this.originalImage.type),[2]}})})},t.prototype.chooseFilters=function(){var t=this,e={filter:this.selectedFilter};this.bottomSheet.open(f,{data:e}).afterDismissed().subscribe(function(){t.selectedFilter=e.filter,t.applyFilter(!0)})},t.prototype.loadFile=function(r){var e=this;return new Promise(function(o,t){return p(e,void 0,void 0,function(){var e,i,n=this;return l(this,function(t){switch(t.label){case 0:this.processing.emit(!0),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.readImage(r)];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),console.error(e),this.error.emit(new Error(e)),[3,4];case 4:return t.trys.push([4,6,,7]),[4,this.showPreview()];case 5:return t.sent(),[3,7];case 6:return i=t.sent(),console.error(i),this.error.emit(new Error(i)),[3,7];case 7:return this.imageLoaded=!0,[4,this.limitsService.setPaneDimensions({width:this.previewDimensions.width,height:this.previewDimensions.height})];case 8:return t.sent(),setTimeout(function(){return p(n,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,this.detectContours()];case 1:return t.sent(),this.processing.emit(!1),o(),[2]}})})},15),[2]}})})})},t.prototype.readImage=function(c){var t=this;return new Promise(function(s,a){return p(t,void 0,void 0,function(){var i,n,o,r=this;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function e(){return new Promise(function(e,i){var n=new FileReader;n.onload=function(t){e(n.result)},n.onerror=function(t){i(t)},n.readAsDataURL(c)})}()];case 1:return i=t.sent(),[3,3];case 2:return n=t.sent(),a(n),[3,3];case 3:return(o=new Image).onload=function(){r.editedImage=document.createElement("canvas"),r.editedImage.width=o.width,r.editedImage.height=o.height,r.imageDimensions.width=o.width,r.imageDimensions.height=o.height,r.editedImage.getContext("2d").drawImage(o,0,0),r.setPreviewPaneDimensions(r.editedImage),s()},o.src=i,[2]}})})})},t.prototype.rotateImage=function(){var a=this;return new Promise(function(t,e){a.processing.emit(!0);var i=cv.imread(a.editedImage),n=new cv.Mat;cv.transpose(i,n),cv.flip(n,n,1),cv.imshow(a.editedImage,n),i["delete"](),n["delete"]();var o={width:0,height:0};Object.assign(o,a.previewDimensions);var r=Array.from(a.points);a.setPreviewPaneDimensions(a.editedImage);var s={width:a.previewDimensions.width/o.width,height:a.previewDimensions.height/o.height};a.limitsService.rotateClockwise(s,o,r),a.showPreview().then(function(){a.processing.emit(!1),t()})})},t.prototype.detectContours=function(){var c=this;return new Promise(function(t,e){var i=cv.imread(c.editedImage),n=(new cv.Size(.5*i.rows,.5*i.cols),new cv.Size(5,5));cv.cvtColor(i,i,cv.COLOR_RGBA2GRAY,0),cv.GaussianBlur(i,i,n,0,0,cv.BORDER_DEFAULT),cv.Canny(i,i,75,200),cv.threshold(i,i,120,200,cv.THRESH_BINARY);var o=new cv.MatVector,r=new cv.Mat;cv.findContours(i,o,r,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);var s=cv.boundingRect(i);i["delete"](),r["delete"](),o["delete"](),Object.keys(s).forEach(function(t){s[t]=s[t]*c.imageResizeRatio});var a=[new m({x:s.x,y:s.y},["left","top"]),new m({x:s.x+s.width,y:s.y},["right","top"]),new m({x:s.x+s.width,y:s.y+s.height},["right","bottom"]),new m({x:s.x,y:s.y+s.height},["left","bottom"])];c.limitsService.repositionPoints(a),t()})},t.prototype.transform=function(){var f=this;return new Promise(function(t,e){f.processing.emit(!0);var i=cv.imread(f.editedImage),n=new cv.Mat,o=[f.getPoint(["top","left"]),f.getPoint(["top","right"]),f.getPoint(["bottom","right"]),f.getPoint(["bottom","left"])].map(function(t){return[t.x/f.imageResizeRatio,t.y/f.imageResizeRatio]}),r=f.getPoint(["bottom","right"]).x-f.getPoint(["bottom","left"]).x,s=f.getPoint(["top","right"]).x-f.getPoint(["top","left"]).x,a=Math.max(r,s)/f.imageResizeRatio,c=f.getPoint(["bottom","left"]).y-f.getPoint(["top","left"]).y,h=f.getPoint(["bottom","right"]).y-f.getPoint(["top","right"]).y,p=Math.max(c,h)/f.imageResizeRatio,l=[[0,0],[a-1,0],[a-1,p-1],[0,p-1]],u=cv.matFromArray(4,1,cv.CV_32FC2,[].concat.apply([],v(o))),d=cv.matFromArray(4,1,cv.CV_32FC2,[].concat.apply([],v(l))),m=cv.getPerspectiveTransform(u,d),g=new cv.Size(a,p);cv.warpPerspective(i,n,m,g,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),cv.imshow(f.editedImage,n),i["delete"](),n["delete"](),u["delete"](),d["delete"](),m["delete"](),f.setPreviewPaneDimensions(f.editedImage),f.showPreview().then(function(){f.processing.emit(!1),t()})})},t.prototype.applyFilter=function(r){var e=this;return new Promise(function(o,t){return p(e,void 0,void 0,function(){var e,i,n;return l(this,function(t){switch(t.label){case 0:switch(this.processing.emit(!0),e={blur:!1,th:!0,thMode:cv.ADAPTIVE_THRESH_MEAN_C,thMeanCorrection:10,thBlockSize:25,thMax:255,grayScale:!0},i=cv.imread(this.editedImage),this.selectedFilter){case"original":e.th=!1,e.grayScale=!1,e.blur=!1;break;case"magic_color":e.grayScale=!1;break;case"bw2":e.thMode=cv.ADAPTIVE_THRESH_GAUSSIAN_C,e.thMeanCorrection=15,e.thBlockSize=15;break;case"bw3":e.blur=!0,e.thMeanCorrection=15}return e.grayScale&&cv.cvtColor(i,i,cv.COLOR_RGBA2GRAY,0),e.blur&&(n=new cv.Size(5,5),cv.GaussianBlur(i,i,n,0,0,cv.BORDER_DEFAULT)),e.th&&(e.grayScale?cv.adaptiveThreshold(i,i,e.thMax,e.thMode,cv.THRESH_BINARY,e.thBlockSize,e.thMeanCorrection):(i.convertTo(i,-1,1,60),cv.threshold(i,i,170,255,cv.THRESH_BINARY))),r||cv.imshow(this.editedImage,i),[4,this.showPreview(i)];case 1:return t.sent(),this.processing.emit(!1),o(),[2]}})})})},t.prototype.resize=function(c){var h=this;return new Promise(function(t,e){h.processing.emit(!0);var i=cv.imread(h.editedImage),n=i.size().width,o=i.size().height,r={width:0,height:0};if(n>h.options.maxImageDimensions.width){r.width=h.options.maxImageDimensions.width,r.height=h.options.maxImageDimensions.width/n*o,r.height>h.options.maxImageDimensions.height&&(r.height=h.options.maxImageDimensions.height,r.width=h.options.maxImageDimensions.height/o*n);var s=new cv.Size(Math.floor(r.width),Math.floor(r.height));cv.resize(i,i,s,0,0,cv.INTER_AREA);var a=document.createElement("canvas");cv.imshow(a,i),i["delete"](),h.processing.emit(!1),t(a)}else t(c||h.editedImage)})},t.prototype.showPreview=function(r){var s=this;return new Promise(function(t,e){var i;i=r||cv.imread(s.editedImage);var n=new cv.Mat,o=new cv.Size(0,0);cv.resize(i,n,o,s.imageResizeRatio,s.imageResizeRatio,cv.INTER_AREA),cv.imshow(s.previewCanvas.nativeElement,n),i["delete"](),n["delete"](),t()})},t.prototype.setPreviewPaneDimensions=function(t){this.previewDimensions=this.calculateDimensions(t.width,t.height),this.previewCanvas.nativeElement.width=this.previewDimensions.width,this.previewCanvas.nativeElement.height=this.previewDimensions.height,this.imageResizeRatio=this.previewDimensions.width/t.width,this.imageDivStyle={width:this.previewDimensions.width+this.options.cropToolDimensions.width+"px",height:this.previewDimensions.height+this.options.cropToolDimensions.height+"px","margin-left":"calc((100% - "+(this.previewDimensions.width+10)+"px) / 2 + "+this.options.cropToolDimensions.width/2+"px)","margin-right":"calc((100% - "+(this.previewDimensions.width+10)+"px) / 2 - "+this.options.cropToolDimensions.width/2+"px)"},this.limitsService.setPaneDimensions({width:this.previewDimensions.width,height:this.previewDimensions.height})},t.prototype.calculateDimensions=function(t,e){var i=t/e,n=this.screenDimensions.width>this.maxPreviewWidth?this.maxPreviewWidth:this.screenDimensions.width-20,o=this.screenDimensions.height-200,r={width:n,height:Math.round(n/i),ratio:i};return r.height>o&&(r.height=o,r.width=Math.round(o*i)),r},t.prototype.getPoint=function(e){var i=this;return this.points.find(function(t){return i.limitsService.compareArray(t.roles,e)})},t.decorators=[{type:o.Component,args:[{selector:"ngx-doc-scanner",template:'<div [ngStyle]="editorStyle" fxLayoutAlign="space-around">\n  <div #imageContainer [ngStyle]="imageDivStyle" style="margin: auto;" >\n    <ng-container *ngIf="imageLoaded && mode === \'crop\'">\n      <ngx-shape-outine #shapeOutline [color]="options.cropToolColor" [weight]="options.cropToolLineWeight" [dimensions]="previewDimensions"></ngx-shape-outine>\n      <ngx-draggable-point #topLeft [pointOptions]="options.pointOptions" [startPosition]="{x: 0, y: 0}" [limitRoles]="[\'top\', \'left\']" [container]="imageContainer"></ngx-draggable-point>\n      <ngx-draggable-point #topRight [pointOptions]="options.pointOptions" [startPosition]="{x: previewDimensions.width, y: 0}" [limitRoles]="[\'top\', \'right\']" [container]="imageContainer"></ngx-draggable-point>\n      <ngx-draggable-point #bottomLeft [pointOptions]="options.pointOptions" [startPosition]="{x: 0, y: previewDimensions.height}" [limitRoles]="[\'bottom\', \'left\']" [container]="imageContainer"></ngx-draggable-point>\n      <ngx-draggable-point #bottomRight [pointOptions]="options.pointOptions" [startPosition]="{x: previewDimensions.width, y: previewDimensions.height}" [limitRoles]="[\'bottom\', \'right\']" [container]="imageContainer"></ngx-draggable-point>\n    </ng-container>\n    <canvas #PreviewCanvas [ngStyle]="{\'max-width\': options.maxPreviewWidth}" style="z-index: 5" ></canvas>\n  </div>\n  <div class="editor-actions" fxLayout="row" fxLayoutAlign="space-around" style="position: absolute; bottom: 0; width: 100vw">\n    <ng-container *ngFor="let button of displayedButtons" [ngSwitch]="button.type">\n      <button mat-mini-fab *ngSwitchCase="\'fab\'" [name]="button.name" (click)="button.action()" [color]="options.buttonThemeColor">\n        <mat-icon>{{button.icon}}</mat-icon>\n      </button>\n      <button mat-raised-button *ngSwitchCase="\'button\'" [name]="button.name" (click)="button.action()" [color]="options.buttonThemeColor">\n        <mat-icon>{{button.icon}}</mat-icon>\n        <span>{{button.text}}}</span>\n      </button>\n    </ng-container>\n  </div>\n</div>\n\n\n',styles:[".editor-actions{padding:12px}.editor-actions button{margin:5px}"]}]}],t.ctorParameters=function(){return[{type:h},{type:d},{type:r.MatBottomSheet}]},t.propDecorators={previewCanvas:[{type:o.ViewChild,args:["PreviewCanvas",{read:o.ElementRef}]}],exitEditor:[{type:o.Output}],editResult:[{type:o.Output}],error:[{type:o.Output}],ready:[{type:o.Output}],processing:[{type:o.Output}],file:[{type:o.Input}],config:[{type:o.Input}]},t}(),b=function S(e){var i=this;this.maxImageDimensions={width:800,height:1200},this.editorBackgroundColor="dimgrey",this.editorDimensions={width:"100vw",height:"100vh"},this.extraCss={position:"absolute",top:0,left:0},this.buttonThemeColor="accent",this.exportImageIcon="cloud_upload",this.cropToolColor="#3cabe2",this.cropToolShape="rect",this.cropToolDimensions={width:10,height:10},this.cropToolLineWeight=3,this.maxPreviewWidth=800,e&&Object.keys(e).forEach(function(t){i[t]=e[t]}),this.editorStyle={"background-color":this.editorBackgroundColor},Object.assign(this.editorStyle,this.editorDimensions),Object.assign(this.editorStyle,this.extraCss),this.pointOptions={shape:this.cropToolShape,color:this.cropToolColor,width:0,height:0},Object.assign(this.pointOptions,this.cropToolDimensions)},e=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:c,useValue:t}]}},e.decorators=[{type:o.NgModule,args:[{declarations:[g,f,y,w],imports:[n.FlexLayoutModule,r.MatButtonModule,r.MatIconModule,r.MatBottomSheetModule,r.MatListModule,s.AngularDraggableModule,a.CommonModule],exports:[w],entryComponents:[f],providers:[h,d]}]}],e}();t.NgxDocumentScannerModule=e,t.NgxDocScannerComponent=w,t.OpenCvConfigToken=c,t.NgxOpenCvService=h,t.ɵa=g,t.ɵc=f,t.ɵd=y,t.ɵb=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-document-scanner.umd.min.js.map